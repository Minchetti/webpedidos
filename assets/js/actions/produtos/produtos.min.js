$(function(){function t(){$(document).tooltip({items:"[data-image]",track:!0,content:function(){var t=$(this),e=$.trim(t.data("partnumber").toString());if(t.is("[data-image]")){var a=$.trim(t.text());return'<figure><img class="img-responsive img-thumbnail" src="'+s+"/images/produtos/"+e+'.jpg" alt="'+a+'"><figcaption><small>'+a+"</small></figcaption></figure>"}}})}function e(){$("#produtos-selecionados > *").remove(),$.each(d.getProdutoFromStorage(),function(t,e){$("<tr>",{id:"sel-"+e.item.codigo}).appendTo("#produtos-selecionados"),$("<td>",{text:e.item.codigo}).appendTo("#sel-"+e.item.codigo),$("<td>",{text:e.item.partnumber}).appendTo("#sel-"+e.item.codigo),$("<td>",{text:"  "+e.item.descricao,"data-partnumber":e.item.partnumber,"data-image":"",prepend:$("<img>",{src:s+"/images/produtos/"+e.item.partnumber+".jpg",width:"30",heigth:"30"})}).appendTo("#sel-"+e.item.codigo),$("<td>",{text:e.item.ca}).appendTo("#sel-"+e.item.codigo),$("<td>",{class:"text-center",text:e.item.unidade}).appendTo("#sel-"+e.item.codigo),$("<td>",{class:"text-center",text:e.item.quantidade}).appendTo("#sel-"+e.item.codigo),$("<td>",{class:"text-center",append:$("<a>",{text:"Editar",click:function(t){t.preventDefault(),$("#editar-quantidade-produto").modal("toggle"),$("<input>",{type:"hidden",id:"edit-codigo-qty",value:e.item.codigo}).appendTo("body"),setTimeout(function(){$("#txtQuantidadeEdicao").select()},1e3)}})}).appendTo("#sel-"+e.item.codigo),$("<td>",{class:"text-center",append:$("<a>",{text:"Excluir",click:function(t){t.preventDefault(),d.remover(e.item.codigo),$(this).parent().parent().remove()}})}).appendTo("#sel-"+e.item.codigo)}),t()}function a(){if(c>=0&&c<=10){$("#paginacao-produtos > *").remove(),$("<nav>",{class:"text-center","aria-label":"Paginação",append:$("<ul>",{id:"pag",class:"pager"})}).appendTo("#paginacao-produtos");var t=n<=1?"none":"";$("<li>",{id:"p-produto",style:"display: "+t,append:$("<a>",{style:"cursor : pointer","aria-label":"Anterior",text:" Anterior ",click:function(t){t.preventDefault();var e=n-1,a=d.getProdutoFromStorage();n=e<=1?1:e,1===n?$("#p-produto").css("display","none"):$("#p-produto").css("display","");var i=d.listar(p[0].cliente,p[0].cc,p[0].ghe,$.trim($("#txtProduto").val()),n);o(i,a)},prepend:$("<i>",{class:"fa fa-arrow-left","aria-hidden":!0})})}).prepend().appendTo("#pag"),c>=10&&$("<li>",{id:"n-produto",append:$("<a>",{style:"cursor : pointer","aria-label":"Próximo",text:" Próximo ",click:function(t){t.preventDefault();var e=n+1,a=d.getProdutoFromStorage();n=e===r?r:e,e===r?$("#n-produto").css("display","none"):$("#n-produto").css("display","");var i=d.listar(p[0].cliente,p[0].cc,p[0].ghe,$.trim($("#txtProduto").val()),n);o(i,a)},append:$("<i>",{class:"fa fa-arrow-right","aria-hidden":!0})})}).appendTo("#pag")}}function o(o,n){$("#selecionar-produtos > *").remove(),r=parseInt(o.total,10),c=parseInt(o.retornado,10),$.isEmptyObject(o.produtos)?($("<tr>",{id:"lista-vazia",class:"info"}).appendTo("#selecionar-produtos"),$("<td>",{text:"Não há produtos",colspan:6}).appendTo("#lista-vazia")):($.each(o.produtos,function(t,a){var o=!1,r=a.codigo,c="fa-plus",p=0;$.isEmptyObject(n)||$.each(n,function(t,e){e.item.codigo===r&&(o=!0,c="fa-check",p=e.item.quantidade)}),$("<tr>",{id:"item-"+t}).appendTo("#selecionar-produtos"),$("<td>",{id:"cod-"+t,text:a.codigo}).appendTo("#item-"+t),$("<td>",{id:"cod-"+t,text:a.partnumber}).appendTo("#item-"+t),$("<td>",{id:"descricao-"+t,text:"  "+a.descricao,"data-image":"","data-partnumber":a.partnumber,prepend:$("<img>",{src:s+"/images/produtos/"+a.partnumber+".jpg",width:"30",heigth:"30"})}).appendTo("#item-"+t),$("<td>",{id:"ca-"+t,text:a.ca}).appendTo("#item-"+t),$("<td>",{id:"un-"+t,class:"text-center",text:a.unidade}).appendTo("#item-"+t),$("<td>",{class:"text-center",append:$("<input>",{id:"qty-"+t,class:"form-control text-center",disabled:o,type:"text",name:"quantidade",value:p,click:function(e){e.preventDefault(),$("#qty-"+t).select()}})}).appendTo("#item-"+t),$("<td>",{class:"text-center",append:$("<button>",{class:"btn btn-success",append:$("<i>",{class:"fa "+c,"aria-hidden":!0}),disabled:o,click:function(o){o.preventDefault(),"0"!==$("#qty-"+t).val()?(i.push({item:{codigo:a.codigo,descricao:a.descricao,ca:a.ca,unidade:a.unidade,quantidade:$("#qty-"+t).val(),partnumber:a.partnumber,valor:a.preco}}),d.adicionar(i),e(),$("#qty-"+t).prop("disabled",!0),$(this).prop("disabled",!0),$(this).children().removeClass("fa-plus").addClass("fa-check")):(bootbox.alert("A quantidade mínima é de <strong>1 (Um) item </strong>."),$("#qty-"+t).select())}})}).appendTo("#item-"+t)}),t(),$("#selecionar-produtos td input").keyup(function(){$.isNumeric($(this).val())||$(this).val(0).select()}),a(),$("#lista-produtos").on("hidden.bs.modal",function(){i=[]}))}var i=[],d=new Produtos,n=1,r=0,c=0,s=document.location.origin+"/webpedidos/assets",p=[];$("#btnConfirmaQty").click(function(t){t.preventDefault();var a=new Produtos;0!==parseInt($("#txtQuantidadeEdicao").val(),10)?(a.editar($.trim($("#edit-codigo-qty").val()),parseInt($("#txtQuantidadeEdicao").val(),10)),e(),$("#editar-quantidade-produto").modal("toggle")):$("#txtQuantidadeEdicao").select()}),$("#editar-quantidade-produto").on("hidden.bs.modal",function(){$("#edit-codigo-qty").remove(),$("#txtQuantidadeEdicao").val(0)}),$("#txtQuantidadeEdicao").keyup(function(){$.isNumeric($(this).val())||$(this).val(0).select()}),$("#listar-produtos").click(function(t){if(t.preventDefault(),$("#selecionar-produtos > *").remove(),funcionarios=new Funcionario,p=funcionarios.getFuncionarioFromStorage(),$.isEmptyObject(p))$("#avisos-add-produtos > *").remove(),$("<hr>",{class:"invisible"}).prependTo("#avisos-add-produtos"),$("<div>",{class:"alert alert-danger",append:$("<p>",{text:" Adicione ao menos 1 (um) funcionário para poder listar os produtos.",prepend:$("<i>",{class:"glyphicon glyphicon-warning-sign"})})}).appendTo("#avisos-add-produtos"),setTimeout(function(){$("#avisos-add-produtos > *").remove()},6e3);else{var e=d.listar(p[0].cliente,p[0].cc,p[0].ghe,"",1),a=d.getProdutoFromStorage();o(e,a),$("#lista-produtos").modal("toggle")}}),$("#btn-buscarProduto").click(function(t){t.preventDefault();var e=$.trim($("#txtProduto").val()),a=d.getProdutoFromStorage();funcionarios=new Funcionario,p=funcionarios.getFuncionarioFromStorage();var i=d.listar(p[0].cliente,p[0].cc,p[0].ghe,e,n);o(i,a)}),$("#txtProduto").keyup(function(t){var e=$(this).val().length;(13===t.which||e>=3||0===e)&&(n=1,$("#btn-buscarProduto").trigger("click"))}),d.init(),e()});