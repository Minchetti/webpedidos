$(function(){function e(){$("#funcionarios-selecionados > *").remove(),$.each($.parseJSON(sessionStorage.getItem("funcionarios")),function(e,o){$("<tr>",{id:"funcionario-sel-"+e}).appendTo("#funcionarios-selecionados"),$("<td>",{text:o.matricula}).appendTo("#funcionario-sel-"+e),$("<td>",{text:o.nome}).appendTo("#funcionario-sel-"+e),$("<td>",{text:o.setor?o.setor:"N/D"}).appendTo("#funcionario-sel-"+e),$("<td>",{text:o.ghe?o.ghe:"N/D"}).appendTo("#funcionario-sel-"+e),$("<td>",{class:"text-center",text:o.local}).appendTo("#funcionario-sel-"+e),$("<td>",{class:"text-center",text:o.turno}).appendTo("#funcionario-sel-"+e),$("<td>",{class:"text-center",append:$("<a>",{text:"Excluir",click:function(e){e.preventDefault();var t=new Funcionario;t.remover(o.matricula),$(this).parent().parent().remove()}})}).appendTo("#funcionario-sel-"+e)})}var o=null,t=[],a=[],n=new Funcionario;n.init(),2===parseInt(sessionStorage.getItem("tipo"),10)&&($("#cbTurno option").slice(0,3).remove(),$("#cbTurnoSetor option").slice(0,3).remove());var i={url:function(e){return o=!!$.isNumeric(e),"funcionario/funcionario/listar/"+e},getValue:function(e){return o?e.matricula:e.nome},ajaxSettings:{type:"GET",dataType:"JSON"},template:{type:"description",fields:{description:"nome"}},list:{showAnimation:{type:"fade",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},maxNumberOfElements:10,onSelectItemEvent:function(){},onHideListEvent:function(){},onChooseEvent:function(){t=[];var e=$("#txtFuncionario").getSelectedItemData(),o=e.setor?e.setor:"N/D";e.ghe?e.ghe:"N/D";$("#txtNomeFuncionario").val(e.nome),$("#spNome").html(e.nome),$("#spSetor").html(o),t.push({matricula:e.matricula,nome:e.nome,setor:e.setor,ghe:e.ghe,cliente:e.cliente,cc:e.cc}),$("#cbLocal > *").remove(),$("<option>",{value:"Carregando ...",text:"Carregando ..."}).appendTo("#cbLocal");var a=new Local;setTimeout(function(){$("#cbLocal > *").remove(),$.each(a.listarEntrega(o),function(e,o){var t=o.local;$("<option>",{value:t.toUpperCase(),text:t.toUpperCase()}).appendTo("#cbLocal"),$("#btnAdicionarFuncionario").prop("disabled",!1)})},1e3)},match:{enabled:!0}}};$("#txtFuncionario").easyAutocomplete(i),$("#btnAdicionarFuncionario").click(function(o){o.preventDefault(),a=[];var i=$("#cbLocal option:selected").text(),c=$("#cbTurno option:selected").text();$.each(t,function(e,o){a.push({matricula:o.matricula,nome:o.nome,setor:o.setor,ghe:o.ghe,local:i,turno:c,cliente:o.cliente,cc:o.cc})}),n.adicionar(a)?($("#funcionarios-avisos > *").remove(),$("#funcionarios-avisos").addClass("alert alert-warning"),$("<p>",{text:" Não é possível adicionar funcionários de centro de custos diferentes na requisição.",prepend:$("<i>",{class:"glyphicon glyphicon-exclamation-sign"})}).appendTo("#funcionarios-avisos"),setTimeout(function(){$("#funcionarios-avisos").removeClass("alert alert-warning"),$("#funcionarios-avisos > *").remove()},6e3),$("#txtFuncionario").val("").focus(),$("#spNome").html(""),$("#spSetor").html(""),$("#cbLocal").prop("selectedIndex",0),$("#cbTurno").prop("selectedIndex",0)):(e(),t=[],$("#txtFuncionario").val(""),$("#spNome").html(""),$("#spSetor").html(""),$("#cbLocal").prop("selectedIndex",0),$("#cbTurno").prop("selectedIndex",0),$("#lista-funcionarios").modal("toggle"))}),e(),$("#lista-funcionarios").on("hidden.bs.modal",function(){$("#spNome").html(""),$("#spSetor").html(""),$("#txtFuncionario").val(""),$("#cbLocal > *").remove(),$("#btnAdicionarFuncionario").prop("disabled",!0)}),$("#btn-adicionarSetor").click(function(o){o.preventDefault();var t=[],i=$.trim($("#cbLocalSetor option:selected").text()),c=$.trim($("#cbTurnoSetor option:selected").text()),r=!!$("#verifica-local-default").is(":checked"),l=$.trim($("#setor-depto").val()),s=$.trim($("#spSetorNome").text());if(a=[],t=n.listarPorSetor(s,l),$.each(t,function(e,o){a.push({matricula:o.matricula,nome:o.nome,setor:o.setor,local:i,turno:c,cliente:l,cc:o.cc})}),$("#lista-setor-funcionarios").modal("toggle"),r)n.adicionar(a)?($("#aviso-local-setor > *").remove(),$("#aviso-local-setor").addClass("alert alert-warning"),$("<p>",{text:" Não é permitido acrescentar setores ou usuários de centro de custos diferentes na mesma requisição.",prepend:$("<i>",{class:"glyphicon glyphicon-exclamation-sign"})}).appendTo("#aviso-local-setor"),setTimeout(function(){$("#aviso-local-setor").removeClass("alert alert-warning"),$("#aviso-local-setor > *").remove()},6e3)):$("#lista-setor-funcionarios .close").trigger("click");else{var u=n.getFuncionarioFromStorage();if($.isEmptyObject(u)||u[0].cliente===a[0].cliente){$("#lista-funcionarios-setor > *").remove();var i=new Local,p=i.listarEntrega(a[0].setor);$.each(a,function(e,o){$("<div>",{id:"lista-funcionario-"+e,class:"row"}).appendTo("#lista-funcionarios-setor"),$("<div>",{class:"col-lg-4",append:$("<strong>",{text:" "+o.nome}),prepend:$("<i>",{class:"fa fa-user-circle"})}).append($("<span>",{id:"spFuncionarioEntrega-"+o.matricula})).appendTo("#lista-funcionario-"+e),$("<div>",{class:"col-lg-4",append:$("<select>",{class:"form-control",id:"localFuncionario-"+o.matricula})}).appendTo("#lista-funcionario-"+e),$.each(p,function(e,t){var a=t.local;$("<option>",{text:a.toUpperCase(),value:a.toUpperCase()}).appendTo("#localFuncionario-"+o.matricula)}),$("<div>",{class:"col-lg-4",append:$("<select>",{class:"form-control",id:"turnoFuncionario-"+o.matricula})}).appendTo("#lista-funcionario-"+e),$.each(["PRIMEIRO","SEGUNDO","TERCEIRO","ADMINISTRATIVO"],function(e,t){$("<option>",{text:t,value:t}).appendTo("#turnoFuncionario-"+o.matricula)})}),$("#selecionar-local-entrega").modal("toggle")}else $("#aviso-local-setor > *").remove(),$("#aviso-local-setor").addClass("alert alert-warning"),$("<p>",{text:" Não é permitido acrescentar setores ou usuários de centro de custos diferentes na mesma requisição.",prepend:$("<i>",{class:"glyphicon glyphicon-exclamation-sign"})}).appendTo("#aviso-local-setor"),setTimeout(function(){$("#aviso-local-setor").removeClass("alert alert-warning"),$("#aviso-local-setor > *").remove()},6e3);$("#txtSetor").focus()}e(),$("#spSetorNome").html(" - "),$("#spSetorFantasia").html(" - "),$("#txtSetor").val(""),$("#frmLocalEntregaSetor").css("display",""),$("#verifica-local-default").prop("checked",!0),$("#setor-depto").remove(),$("#cbLocalSetor").prop("selectedIndex",0),$("#cbTurnoSetor").prop("selectedIndex",0)}),$("#btn-localEntregaSelecionado").click(function(o){o.preventDefault(),t=[],$.each(a,function(e,o){t.push({matricula:o.matricula,nome:o.nome,setor:o.setor,local:$.trim($("#localFuncionario-"+o.matricula+" option:selected").text()),turno:$.trim($("#turnoFuncionario-"+o.matricula+" option:selected").text()),cc:o.cc,cliente:o.cliente})}),n.adicionar(t),e(),$("#selecionar-local-entrega .close").trigger("click")}),$("#selecionar-local-entrega").on("hidden.bs.modal",function(){t=[],a=[],$("#lista-funcionarios-setor > *").remove()})});