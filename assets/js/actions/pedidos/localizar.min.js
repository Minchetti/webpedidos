$(function(){function a(){if(c>=0&&c<=10){$("#paginacao-pedidos > *").remove(),$("<nav>",{class:"text-center","aria-label":"Paginação",append:$("<ul>",{id:"pag",class:"pager"})}).appendTo("#paginacao-pedidos");var a=m<=1?"none":"";$("<li>",{id:"p-pedidos",style:"display: "+a,append:$("<a>",{style:"cursor : pointer","aria-label":"Anterior",text:" Anterior ",click:function(a){a.preventDefault();var t=m-1;m=t<=1?1:t,0===m?$("#p-pedidos").css("display","none"):$("#p-pedidos").css("display","");var i=p.localizarPedido(r(),m);e(i)},prepend:$("<i>",{class:"fa fa-arrow-left","aria-hidden":!0})})}).appendTo("#pag"),c>=10&&$("<li>",{id:"n-pedidos",append:$("<a>",{style:"cursor : pointer","aria-label":"Próximo",text:" Próximo ",click:function(a){a.preventDefault();var t=m+1;m=t===u?u:t,t===u?$("#n-pedidos").css("display","none"):$("#n-pedidos").css("display","");var i=p.localizarPedido(r(),m);e(i)},append:$("<i>",{class:"fa fa-arrow-right","aria-hidden":!0})})}).appendTo("#pag")}}function t(){if(c>=0&&c<=10){$("#paginacao-pedidos > *").remove(),$("<nav>",{class:"text-center","aria-label":"Paginação",append:$("<ul>",{id:"pag",class:"pager"})}).appendTo("#paginacao-pedidos");var a=m<=1?"none":"";$("<li>",{id:"p-pedidos",style:"display: "+a,append:$("<a>",{style:"cursor : pointer","aria-label":"Anterior",text:" Anterior ",click:function(a){a.preventDefault();var t=m-1;m=t<=1?1:t,0===m?$("#p-pedidos").css("display","none"):$("#p-pedidos").css("display","");var e=p.listarPendentes(r(),m);i(e)},prepend:$("<i>",{class:"fa fa-arrow-left","aria-hidden":!0})})}).appendTo("#pag"),c>=10&&$("<li>",{id:"n-pedidos",append:$("<a>",{style:"cursor : pointer","aria-label":"Próximo",text:" Próximo ",click:function(a){a.preventDefault();var t=m+1;m=t===u?u:t,t===u?$("#n-pedidos").css("display","none"):$("#n-pedidos").css("display","");var e=p.listarPendentes(r(),m);i(e)},append:$("<i>",{class:"fa fa-arrow-right","aria-hidden":!0})})}).appendTo("#pag")}}function e(t){$("#resultado-consulta > *").remove(),u=parseInt(t.total,10),c=parseInt(t.retornado,10),$.isEmptyObject(t.pedidos)?($("#resultado-consulta > *").remove(),$("<tr>",{id:"lista-pedidos-info",class:"info"}).appendTo("#resultado-consulta"),$("<td>",{text:"Não existem pedidos com estes critérios",colspan:10}).appendTo("#lista-pedidos-info")):$.each(t.pedidos,function(a,t){$("<tr>",{id:"lista-pedidos-"+a}).appendTo("#resultado-consulta"),$("<td>",{text:t.numero}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.funcionario}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.turno}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.cc}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.setor}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.emissao}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.status_pedido}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.solicitante}).appendTo("#lista-pedidos-"+a),$("<td>",{append:$("<a>",{href:"#","data-toggle":"modal","data-target":"#detalhes-pedido",style:"cursor: pointer;",text:" Visualizar ",click:function(a){a.preventDefault(),$("#num-pedido-detalhe").html(t.numero),$("#observacao-detalhe").html(t.observacao),$("#funcionario-detalhe").html(t.funcionario),$("#emissao-detalhe").html(t.emissao),$("#entrega-detalhe").html(t.local_entrega.toUpperCase()),$("#turno-detalhe").html(t.turno);var e=new Produtos,i=e.recuperar(t.numero);$.isEmptyObject(i)||($("#detalhes-itens > *").remove(),$.each(i,function(a,t){$("<tr>",{id:"itens-"+a}).appendTo("#detalhes-itens"),$("<td>",{text:t.codigo}).appendTo("#itens-"+a),$("<td>",{text:t.descricao+" ","data-partnumber":t.partnumber,"data-image":"",prepend:$("<img>",{src:l+"/images/produtos/"+t.partnumber+".jpg",width:"30",heigth:"30"})}).appendTo("#itens-"+a),$("<td>",{text:t.ca}).appendTo("#itens-"+a),$("<td>",{text:t.unidade}).appendTo("#itens-"+a),$("<td>",{class:"text-center",text:t.qty}).appendTo("#itens-"+a)}),o())},append:$("<i>",{class:"fa fa-hand-pointer-o","aria-hidden":!0})})}).appendTo("#lista-pedidos-"+a)}),a()}function i(a){$("#resultado-consulta > *").remove(),u=parseInt(a.total,10),c=parseInt(a.retornado,10),$.isEmptyObject(a.solicitacoes)?($("#resultado-consulta > *").remove(),$("<tr>",{id:"lista-pedidos-info",class:"info"}).appendTo("#resultado-consulta"),$("<td>",{text:"Não existem pedidos com estes critérios",colspan:10}).appendTo("#lista-pedidos-info")):$.each(a.solicitacoes,function(a,t){$("<tr>",{id:"lista-pedidos-"+a}).appendTo("#resultado-consulta"),$("<td>",{id:"n-solicitacao","data-solicitacao":parseInt(t.numero,10),text:t.numero}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.funcionario}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.turno}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.cc}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.setor}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.emissao}).appendTo("#lista-pedidos-"+a),$("<td>",{text:JSON.parse(t.aprovacao)?"NÃO APROVADO":"AGUARDANDO"}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.solicitante}).appendTo("#lista-pedidos-"+a),$("<td>",{text:t.aprovador}).appendTo("#lista-pedidos-"+a),$("<td>",{append:$("<a>",{href:"#","data-toggle":"modal","data-target":"#detalhes-pedido",style:"cursor: pointer;",text:" Visualizar ",click:function(a){a.preventDefault(),$("#btn-aprovar").prop("disabled",!1),$("#btn-nao-aprovar").prop("disabled",!1),$("#num-pedido-detalhe").html(t.numero),$("#observacao-detalhe").html(t.observacao),$("#funcionario-detalhe").html(t.funcionario),$("#emissao-detalhe").html(t.emissao),$("#entrega-detalhe").html(t.local_entrega.toUpperCase()),$("#turno-detalhe").html(t.turno),JSON.parse(t.naoaprovado)?($("#nao-aprovado-wrapper").css("display","block"),$("#motivo-nao-aprovacao").html(t.motivo_nao_aprovado),$("#btn-nao-aprovar").prop("disabled",!0),$("#btn-aprovar").prop("disabled",!0)):($("#nao-aprovado-wrapper").css("display","none"),$("#motivo-nao-aprovacao").html(""));var e=new Produtos,i=e.solicitacaoItens(t.numero);if(!$.isEmptyObject(i.itens)){var n=i.parametros;JSON.parse(n)?($("#total-solicitacao").html("R$ "+i.total),$("#valor-total-solicitacao").css("display","block")):($("#total-solicitacao").remove(),$("#valor-total-solicitacao").remove()),$("#detalhes-itens > *").remove(),$.each(i.itens,function(a,t){$("<tr>",{id:"itens-"+a}).appendTo("#detalhes-itens"),$("<td>",{text:t.codigo}).appendTo("#itens-"+a),$("<td>",{text:t.descricao+" ","data-partnumber":t.partnumber,"data-image":"",prepend:$("<img>",{src:l+"/images/produtos/"+t.partnumber+".jpg",width:"30",heigth:"30"})}).appendTo("#itens-"+a),$("<td>",{text:t.ca}).appendTo("#itens-"+a),$("<td>",{text:t.unidade}).appendTo("#itens-"+a),$("<td>",{class:"text-center",text:t.qty}).appendTo("#itens-"+a),JSON.parse(n)&&$("<td>",{class:"text-center",text:"R$ "+t.valor_exibicao_item}).appendTo("#itens-"+a)}),o()}},append:$("<i>",{class:"fa fa-hand-pointer-o","aria-hidden":!0})})}).appendTo("#lista-pedidos-"+a)}),t()}function o(){$(document).tooltip({items:"[data-image]",track:!0,content:function(){var a=$(this),t=$.trim(a.data("partnumber").toString());if(a.is("[data-image]")){var e=$.trim(a.text());return'<figure><img class="img-responsive img-thumbnail" src="'+l+"/images/produtos/"+t+'.jpg" alt="'+e+'"><figcaption><small>'+e+"</small></figcaption></figure>"}}})}function n(a){var t=a.split("/").map(Number),e=!1,i=null;return t[1]>12||t[0]>31?e=!1:(i=new Date(t[2],t[1],t[0]),"Invalid Date"!==i.toDateString()&&(e=!0)),e}function d(a){var t=a.split("/").map(Number),e=new Date(t[2],t[1]-1,t[0]);return e.toISOString().substring(0,10)}function r(){var a=$("#num-inicial").val(),t=$("#num-final").val(),e=$("#data-inicial").val(),i=$("#data-final").val(),o=$("#txtFuncionario").val(),n=$("#txtNomeFuncionario").val(),r=$("#cbTurno option:selected").val(),s=$("#cbStatusAprovacao option:selected").val(),l=$("#cbStatusRequisicao option:selected").val(),p=[];return $.trim(e)&&(e=d(e)),$.trim(i)&&(i=d(i)),p={"num-inicial":a,"num-final":t,"data-inicial":e,"data-final":i,matricula:o,nome:n,turno:r,requisicao:l,aprovacao:s}}function s(a){var t;try{t=$.datepicker.parseDate(f,a.value)}catch(a){t=null}return t}var l=document.location.origin+"/webpedidos/assets",p=new Requisicao,c=0,u=0,m=1;$("[title]").tooltip({position:{my:"center bottom-20",at:"center top"}});var h=(new Date).toLocaleString("pt-BR").substring(0,10);$("#data-inicial, #data-final").attr("placeholder",h),$("#data-final").prop("disabled",!0),$("#num-final").prop("disabled",!0),$("#num-inicial, #num-final, #data-inicial, #data-final").keyup(function(){$.isNumeric($(this).val())||$(this).select()}),$("#num-inicial").keyup(function(){$.trim($(this).val())?$("#num-final").prop("disabled",!1):$("#num-final").prop("disabled",!0)}),$("#data-inicial, #data-final").keyup(function(){$(this).val()&&$(this).attr("maxlength",8)}),$("#data-inicial, #data-final").focusout(function(){var a=$(this).val().replace(/(\d{2})(\d{2})(\d{4})/g,"$1/$2/$3");$(this).attr("maxlength",10).val(a)}),$("#data-inicial").change(function(){var a=$(this).val().replace(/(\d{2})(\d{2})(\d{4})/g,"$1/$2/$3");$(this).val()?n(a)?$("#data-final").prop("disabled",!1):bootbox.alert({size:"small",title:"ATENÇÃO",message:"Data inválida, por favor, adicione uma data válida!",callback:function(){$("#data-inicial").val("").attr("maxlength",8),$("#data-final").prop("disabled",!0)}}):$("#data-final").prop("disabled",!0)}),$("#data-final").change(function(){var a=$(this).val().replace(/(\d{2})(\d{2})(\d{4})/g,"$1/$2/$3");$(this).val()?n(a)||bootbox.alert({size:"small",title:"ATENÇÃO",message:"Data inválida. Por favor, adicione uma data válida!",callback:function(){$("#data-final").val("").attr("maxlength",8)}}):$("#data-final").prop("disabled",!0)});var f="dd/mm/yy",v=$("#data-inicial").datepicker({showAnim:"slideDown",maxDate:"+0M",defaultDate:"+1w",changeMonth:!0,changeYear:!0,showOtherMonths:!0,selectOtherMonths:!0,numberOfMonths:2,dateFormat:"dd/mm/yy",dayNames:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],dayNamesMin:["D","S","T","Q","Q","S","S","D"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb","Dom"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],nextText:"Próximo",prevText:"Anterior"}).on("change",function(){g.datepicker("option","minDate",s(this)),$("#data-final").prop("disabled",!1)}),g=$("#data-final").datepicker({showAnim:"slideDown",maxDate:"+0M",defaultDate:"+1w",changeMonth:!0,changeYear:!0,showOtherMonths:!0,selectOtherMonths:!0,numberOfMonths:2,dateFormat:"dd/mm/yy",dayNames:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],dayNamesMin:["D","S","T","Q","Q","S","S","D"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb","Dom"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],nextText:"Próximo",prevText:"Anterior"}).on("change",function(){v.datepicker("option","maxDate",s(this))}),b={url:function(a){return type=!!$.isNumeric(a),"funcionario/funcionario/listar/"+a},getValue:function(a){return type?a.matricula:a.nome},ajaxSettings:{type:"GET",dataType:"JSON"},template:{type:"description",fields:{description:"nome"}},list:{showAnimation:{type:"fade",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},maxNumberOfElements:10,onSelectItemEvent:function(){},onHideListEvent:function(){},onChooseEvent:function(){var a=$("#txtFuncionario").getSelectedItemData();$("#txtNomeFuncionario").val(a.nome)},match:{enabled:!0}}},x={url:function(a){return type=!!$.isNumeric(a),"funcionario/funcionario/listar/"+a},getValue:function(a){return type?a.matricula:a.nome},requestDelay:750,ajaxSettings:{type:"GET",dataType:"JSON"},template:{type:"description",fields:{description:"matricula"}},list:{showAnimation:{type:"fade",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},maxNumberOfElements:10,onSelectItemEvent:function(){},onHideListEvent:function(){},onChooseEvent:function(){var a=$("#txtNomeFuncionario").getSelectedItemData();$("#txtFuncionario").val(a.matricula)},match:{enabled:!0}}};$("#txtFuncionario").easyAutocomplete(b),$("#txtNomeFuncionario").easyAutocomplete(x),$("#btnBuscar").click(function(a){a.preventDefault();var t=p.localizarPedido(r(),1);e(t)}),$("#btnBuscarSolicitacoes").click(function(a){a.preventDefault();var t=p.listarPendentes(r(),1);i(t)}),$("#detalhes-pedido").on("hidden.bs.modal",function(){$("#num-pedido-detalhe").html(""),$("#observacao-detalhe").html(""),$("#funcionario-detalhe").html(""),$("#emissao-detalhe").html(""),$("#entrega-detalhe").html(""),$("#turno-detalhe").html(""),$("#detalhes-itens > *").remove(),$("#motivo-nao-aprovacao").html(""),$("#valor-total-solicitacao").css("display","none"),$("#total-solicitacao").html("")}),$("#btnBuscar").length?$("#btnBuscar").trigger("click"):$("#btnBuscarSolicitacoes").trigger("click"),$(document).keypress(function(a){13==a.which&&($("#btnBuscar").length?$("#btnBuscar").trigger("click"):$("#btnBuscarSolicitacoes").trigger("click"))}),null!==sessionStorage.getItem("pedido")&&($("#num-inicial").val(sessionStorage.getItem("pedido")),$("#btnBuscar").trigger("click"),sessionStorage.removeItem("pedido"))});