$(function(){function e(e,t,a){$("<div>",{id:"alerta-template",title:e,append:$("<p>",{class:"text-center",text:t})}).appendTo("body"),$("#alerta-template").dialog({modal:!0,buttons:{OK:function(){$("#alerta-template").dialog("close"),a&&$("#txtTemplateDescricao").focus(),$("#alerta-template").remove()}}})}function t(){sessionStorage.removeItem("template_funcionarios"),sessionStorage.removeItem("numero_template"),sessionStorage.removeItem("template_observacao"),sessionStorage.removeItem("template_centro_custo"),sessionStorage.removeItem("template_funcionarios_itens")}function a(){$("#txtObservacaoTemplate").val(""),$("#txtTemplateDescricao").val(""),$("#txtSetor").val(""),$("#spSetorFantasia").html(""),$("#spSetorNome").html(""),$("#cb-check-todos").prop("checked",!1).prop("disabled",!1),$("#txtObservacaoCaracter").html(0),$("#txtDescricao-caracter").html(0),$("#lista-funcionarios-setor > *").remove()}function o(e){$("#lista-funcionarios-setor > *").remove(),$.isEmptyObject(e)?($("<tr>",{id:"funcionarios-vazio",class:"info"}).appendTo("#lista-funcionarios-setor"),$("<td>",{colspan:4,text:"Não existem funcionários alocados nesse setor"}).appendTo("#funcionarios-vazio")):$.each(e,function(e,t){$("<tr>",{id:"funcionarios-"+e}).appendTo("#lista-funcionarios-setor"),$("<td>",{append:$("<input>",{id:"seleciona-funcionario-"+e,name:"seleciona-funcionario",type:"checkbox"})}).appendTo("#funcionarios-"+e),$("<td>",{text:t.matricula,"data-centrocusto":t.cc,"data-cliente":t.cliente,"data-matricula":t.matricula}).appendTo("#funcionarios-"+e),$("<td>",{text:t.nome}).appendTo("#funcionarios-"+e),$("<td>",{text:t.cargo}).appendTo("#funcionarios-"+e)})}function i(){$(document).tooltip({items:"[data-image]",track:!0,content:function(){var e=$(this),t=$.trim(e.data("partnumber").toString());if(e.is("[data-image]")){var a=$.trim(e.text());return'<figure><img class="img-responsive img-thumbnail" src="'+p+"/images/produtos/"+t+'.jpg" alt="'+a+'"><figcaption><small>'+a+"</small></figcaption></figure>"}}})}function n(){if(l>=0&&l<=10){$("#paginacao-produtos > *").remove(),$("<nav>",{class:"text-center","aria-label":"Paginação",append:$("<ul>",{id:"pag",class:"pager"})}).appendTo("#paginacao-produtos");var e=r<=1?"none":"";$("<li>",{id:"p-produto",style:"display: "+e,append:$("<a>",{style:"cursor : pointer","aria-label":"Anterior",text:" Anterior ",click:function(e){e.preventDefault();var t=r-1,a=d.getProdutosTemplateFromStorage();r=t<=1?1:t,0===r?$("#p-produto").css("display","none"):$("#p-produto").css("display","");var o=d.listar(sessionStorage.getItem("cliente"),sessionStorage.getItem("centro_custo"),$.trim($("#txtProduto").val()),r);s(o,a)},prepend:$("<i>",{class:"fa fa-arrow-left","aria-hidden":!0})})}).prepend().appendTo("#pag"),l>=10&&$("<li>",{id:"n-produto",append:$("<a>",{style:"cursor : pointer","aria-label":"Próximo",text:" Próximo ",click:function(e){e.preventDefault();var t=r+1,a=d.getProdutosTemplateFromStorage();r=t===c?c:t,t===c?$("#n-produto").css("display","none"):$("#n-produto").css("display","");var o=d.listar(sessionStorage.getItem("cliente"),sessionStorage.getItem("centro_custo"),$.trim($("#txtProduto").val()),r);s(o,a)},append:$("<i>",{class:"fa fa-arrow-right","aria-hidden":!0})})}).appendTo("#pag")}}function s(e,t){$("#selecionar-produtos > *").remove(),c=parseInt(e.total,10),l=parseInt(e.retornado,10),$.isEmptyObject(e.produtos)?($("<tr>",{id:"lista-vazia",class:"info"}).appendTo("#selecionar-produtos"),$("<td>",{text:"Não há produtos",colspan:6}).appendTo("#lista-vazia")):($.each(e.produtos,function(e,a){var o=!1,i=a.codigo,n="fa-plus",s=0;$.isEmptyObject(t)||$.each(t,function(e,t){t.item.codigo===i&&(o=!0,n="fa-check",s=t.item.quantidade)}),$("<tr>",{id:"item-"+e}).appendTo("#selecionar-produtos"),$("<td>",{id:"cod-"+e,text:a.codigo}).appendTo("#item-"+e),$("<td>",{id:"descricao-"+e,text:"  "+a.descricao,"data-image":"","data-partnumber":a.partnumber,prepend:$("<img>",{src:p+"/images/produtos/"+a.partnumber+".jpg",width:"30",heigth:"30"})}).appendTo("#item-"+e),$("<td>",{id:"ca-"+e,text:a.ca}).appendTo("#item-"+e),$("<td>",{id:"un-"+e,class:"text-center",text:a.unidade}).appendTo("#item-"+e),$("<td>",{class:"text-center",append:$("<input>",{id:"qty-"+e,class:"form-control text-center",disabled:o,type:"text",name:"quantidade",value:s,click:function(t){t.preventDefault(),$("#qty-"+e).select()}})}).appendTo("#item-"+e),$("<td>",{class:"text-center",append:$("<button>",{class:"btn btn-success",append:$("<i>",{class:"fa "+n,"aria-hidden":!0}),disabled:o,click:function(t){if(t.preventDefault(),"0"!==$("#qty-"+e).val()){var o=[];o.push({item:{codigo:a.codigo,descricao:a.descricao,ca:a.ca,unidade:a.unidade,quantidade:parseInt($("#qty-"+e).val(),10),partnumber:a.partnumber,valor:a.preco}}),d.produtosTemplate(o),$("#qty-"+e).prop("disabled",!0),$(this).prop("disabled",!0),$(this).children().removeClass("fa-plus").addClass("fa-check")}else bootbox.alert("A quantidade mínima é de <strong>1 (Um) item </strong>."),$("#qty-"+e).select()}})}).appendTo("#item-"+e)}),i(),$("#selecionar-produtos td input").keyup(function(){$.isNumeric($(this).val())||$(this).val(0).select()}),n())}var r=1,c=0,l=0,p=document.location.origin+"/webpedidos/assets",d=new Produtos;sessionStorage.setItem("template_funcionarios_itens",JSON.stringify([])),sessionStorage.removeItem("template_funcionarios",[]),sessionStorage.removeItem("cliente"),sessionStorage.removeItem("centro_custo"),$("#txtTemplateParam").keypress(function(e){13==e.which&&$("#btn-buscarTemplate").trigger("click")}),$("#btn-buscarTemplate").click(function(e){e.preventDefault();var t={num_inicial:$.trim($("#txtTemplateNumero").val()),descricao:$.trim($("#txtTemplateDescricao").val())},a=new Template,o=a.buscar(t);$("#selecionar-template > *").remove(),$("#txtTemplateParam").val(""),$.isEmptyObject(o)?($("<tr>",{id:"template-mensagem",class:"info"}).appendTo("#selecionar-template"),$("<td>",{colspan:5,text:" Não há templates cadastradas com estes critérios",prepend:$("<i>",{class:"glyphicon glyphicon-exclamation-sign"})}).appendTo("#template-mensagem")):$.each(o,function(e,t){$("<tr>",{id:"template-"+e}).appendTo("#selecionar-template"),$("<td>",{text:t.numero}).appendTo("#template-"+e),$("<td>",{text:t.descricao}).appendTo("#template-"+e),$("<td>",{text:t.setor}).appendTo("#template-"+e),$("<td>",{class:"text-center",text:t.usuario}).appendTo("#template-"+e),$("<td>",{class:"text-center",append:$("<a>",{text:"Utilizar",style:"cursor: pointer;",click:function(e){e.preventDefault();var a=new Template;sessionStorage.setItem("numero_template",parseInt(t.numero,10)),sessionStorage.setItem("template_observacao",t.obs),sessionStorage.setItem("template_centro_custo",t.cc),sessionStorage.setItem("template_funcionarios",JSON.stringify(a.funcionariosTemplate(parseInt(t.numero,10)))),$("#lista-templates").modal("toggle"),bootbox.confirm({message:"<div class='alert alert-info'><i class='glyphicon glyphicon-exclamation-sign'></i> Serão entregues no mesmo lugar?</div>",buttons:{confirm:{label:"SIM",className:"btn-success"},cancel:{label:"NÃO",className:"btn-danger"}},callback:function(e){if(e){var t=new Local,a=[],o="",i=$.parseJSON(sessionStorage.getItem("template_funcionarios"));$.each(i,function(e,t){"DESLIGADOS"!==t.setor&&(a.push({id:t.id,cliente:t.cliente,nome:t.nome,matricula:t.matricula}),o=t.setor)}),sessionStorage.setItem("template_funcionarios",JSON.stringify(a));var n=t.listarEntrega(o);$("<div>",{id:"lista-funcionario-todos",class:"row"}).appendTo("#lista-local-entrega-todos"),$("<div>",{class:"col-lg-8",append:$("<select>",{class:"form-control",id:"local-entrega-todos"})}).appendTo("#lista-funcionario-todos"),$.each(n,function(e,t){var a=t.local;$("<option>",{text:a.toUpperCase(),value:a.toUpperCase()}).appendTo("#local-entrega-todos")}),$("<div>",{class:"col-lg-4",append:$("<select>",{class:"form-control",id:"turno-entrega-todos"})}).appendTo("#lista-funcionario-todos"),$.each(["PRIMEIRO","SEGUNDO","TERCEIRO","ADMINISTRATIVO"],function(e,t){$("<option>",{text:t,value:t}).appendTo("#turno-entrega-todos")}),$("#selecionar-local-entrega-todos").modal("toggle")}else{var t=new Local,a=[],o="",i=$.parseJSON(sessionStorage.getItem("template_funcionarios"));$.each(i,function(e,t){"DESLIGADOS"!==t.setor&&(a.push({id:t.id,cliente:t.cliente,nome:t.nome,matricula:t.matricula}),o=t.setor)}),sessionStorage.setItem("template_funcionarios",JSON.stringify(a));var n=t.listarEntrega(o);$.each(a,function(e,t){$("<div>",{id:"lista-funcionario-"+e,class:"row"}).appendTo("#lista-funcionarios-template"),$("<div>",{class:"col-lg-4",append:$("<strong>",{text:" "+t.nome}),prepend:$("<i>",{class:"fa fa-user-circle"})}).append($("<span>",{id:"spFuncionarioEntrega-"+t.matricula})).appendTo("#lista-funcionario-"+e),$("<div>",{class:"col-lg-4",append:$("<select>",{class:"form-control",id:"localFuncionario-"+t.matricula})}).appendTo("#lista-funcionario-"+e),$.each(n,function(e,a){var o=a.local;$("<option>",{text:o.toUpperCase(),value:o.toUpperCase()}).appendTo("#localFuncionario-"+t.matricula)}),$("<div>",{class:"col-lg-4",append:$("<select>",{class:"form-control",id:"turnoFuncionario-"+t.matricula})}).appendTo("#lista-funcionario-"+e),$.each(["PRIMEIRO","SEGUNDO","TERCEIRO","ADMINISTRATIVO"],function(e,a){$("<option>",{text:a,value:a}).appendTo("#turnoFuncionario-"+t.matricula)})}),$("#selecionar-local-entrega-template").modal("toggle")}}})}})}).appendTo("#template-"+e)})}),$("#txtTemplateNumero").keypress(function(e){13==e.which&&$("#btn-buscarTemplate").trigger("click")}),$("#num-inicial, #num-final, #txtDescricao").keypress(function(e){13==e.which&&$("#btn-listarTemplate").trigger("click")}),$("#txtTemplateDescricao, #txtTemplateSetor").keypress(function(e){13==e.which&&$("#btn-buscarTemplate").trigger("click")}),$("#lista-templates").on("hidden.bs.modal",function(){$("#selecionar-template > *").remove()}),$("#txtTemplateDescricao").keyup(function(e){$(this).val().length>=0&&$(this).val().length<=50&&$("#txtDescricao-caracter").html($(this).val().length)}),$("#txtObservacaoTemplate").keyup(function(e){$(this).val().length>=0&&$(this).val().length<=150&&$("#txtObservacaoCaracter").html($(this).val().length)});var m={url:function(e){return"setor/setor/listar/"+e},getValue:function(e){return e.nome},ajaxSettings:{type:"GET",dataType:"JSON"},template:{type:"description",fields:{description:"fantasia"}},list:{showAnimation:{type:"fade",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},maxNumberOfElements:10,onSelectItemEvent:function(){},onHideListEvent:function(){},onChooseEvent:function(){var e=$("#txtSetor").getSelectedItemData(),t=e.nome;$("#spSetorNome").html(t),$("#spSetorFantasia").html(e.fantasia);var a=[],i=$.trim(e.cnpj);g=[];var n=new Funcionario;a=n.listarPorSetor(t,i),$.each(a,function(e,t){g.push({matricula:t.matricula,nome:t.nome,cargo:t.cargo,cliente:i,cc:t.cc})}),o(g),$("#funcionarios-lista thead tr th input").prop("checked",!1).prop("disabled",!1),$("#funcionarios-lista thead tr th:nth-child(5)").remove(),$("#btn-confirmar-selecionados").css("display","block")},match:{enabled:!0}}};$("#txtSetor").easyAutocomplete(m),$("#cb-check-todos").click(function(e){var t=$(e.target).closest("#funcionarios-lista");$("td input:checkbox",t).prop("checked",this.checked)});var u=[];if($("#btn-confirmar-selecionados").click(function(e){e.preventDefault(),$("<th>",{colspan:2,class:"text-center",text:"Ações"}).appendTo("#funcionarios-lista thead tr"),u=$("input:checkbox:checked",$("#lista-funcionarios-setor")).map(function(){$(this).closest("tr").append($("<td>",{append:$("<button>",{class:"btn btn-success",text:" Produtos",prepend:$("<i>",{class:"fa fa-shopping-basket","aria-hidden":!0}),click:function(e){e.preventDefault();var t=new Produtos,a=$(this).closest("tr").find("td:nth-child(2)").data("centrocusto"),o=$(this).closest("tr").find("td:nth-child(2)").data("cliente"),i=$(this).closest("tr").find("td:nth-child(2)").data("matricula");sessionStorage.setItem("cliente",o),sessionStorage.setItem("centro_custo",a),$("<input>",{id:"matricula-funcionario-template",type:"hidden",name:"matricula-funcionario",value:i}).appendTo("body");var n=t.listar(o,a,"",1);s(n,[]),$("#lista-produtos").modal("toggle")}})}));var e=$(this).closest("tr").find("td:nth-child(2)").text();return $(this).closest("tr").append($("<td>",{append:$("<button>",{class:"btn btn-primary",text:" Visualizar",disabled:!1,prepend:$("<i>",{class:"fa fa-eye","aria-hidden":!0}),click:function(t){t.preventDefault();var a=!1,o=JSON.parse(sessionStorage.getItem("template_funcionarios_itens"));$("#visualizar-produtos > *").remove(),$.each(o,function(t,o){o.template.matricula===e&&(a=!0,$.each(o.template.itens,function(e,t){$("<tr>",{id:"visualizar-produtos-"+e}).appendTo("#visualizar-produtos"),$("<td>",{text:t[0].codigo}).appendTo("#visualizar-produtos-"+e),$("<td>",{text:t[0].descricao}).appendTo("#visualizar-produtos-"+e),$("<td>",{text:t[0].ca}).appendTo("#visualizar-produtos-"+e),$("<td>",{class:"text-center",text:t[0].unidade}).appendTo("#visualizar-produtos-"+e),$("<td>",{class:"text-center",text:t[0].quantidade}).appendTo("#visualizar-produtos-"+e)}))}),a&&$("#lista-produtos-visualizacao").modal("toggle")}})})),e}),$("input:checkbox",$("#lista-funcionarios-setor")).map(function(){$(this).is(":checked")?$(this).prop("disabled",!0):$(this).parent().parent().remove()}),$("#funcionarios-lista thead tr th input").prop("checked",!0).prop("disabled",!0),$(this).css("display","none")}),$("#lista-produtos").on("hidden.bs.modal",function(){d.concluirItens($("#matricula-funcionario-template").val()),$("#matricula-funcionario-template").remove()}),$("#selecionar-local-entrega-todos").on("hidden.bs.modal",function(){$("#lista-local-entrega-todos > *").remove(),sessionStorage.removeItem("template_funcionarios")}),$("#btn-listarTemplate").click(function(e){e.preventDefault();var t={num_inicial:$.trim($("#num-inicial").val()),num_final:$.trim($("#num-final").val()),descricao:$.trim($("#txtDescricao").val())},a=new Template,o=a.buscar(t);$("#selecionar-template > *").remove(),$.isEmptyObject(o)?($("<tr>",{id:"template-mensagem",class:"info"}).appendTo("#selecionar-template"),$("<td>",{colspan:5,text:" Não há templates cadastradas com estes critérios",prepend:$("<i>",{class:"glyphicon glyphicon-exclamation-sign"})}).appendTo("#template-mensagem")):$.each(o,function(e,t){$("<tr>",{id:"template-"+e}).appendTo("#selecionar-template"),$("<td>",{id:"template-"+t.numero,text:t.numero}).appendTo("#template-"+e),$("<td>",{text:t.descricao}).appendTo("#template-"+e),$("<td>",{class:"text-center",text:t.usuario}).appendTo("#template-"+e),$("<td>",{class:"text-center",append:$("<a>",{text:"Exibir",style:"cursor: pointer;",click:function(e){e.preventDefault();var a=new Template,o=a.detalhes(t.numero);$("#visualizar-funcionarios > *").remove(),$("#deletar-template #deletar").remove(),$("#atualizar-template #atualizar").remove(),$("<button>",{id:"deletar",class:"btn btn-danger pull-left",text:" Apagar template",prepend:$("<i>",{class:"glyphicon glyphicon-trash"}),click:function(e){e.preventDefault(),$("#detalhes-template-fechar").trigger("click"),$("<div>",{id:"confirma-deletar",title:"Confirmação",append:$("<p>",{text:" Deseja realmente deletar esta template?"})}).appendTo("body"),$("#confirma-deletar").dialog({resizable:!1,height:"auto",width:400,modal:!0,buttons:{Deletar:function(){var e=new Template;e.deletar(t.numero)&&($("#template-"+t.numero).parent().remove(),$("<div>",{id:"deletar-sucesso",title:"Sucesso",append:$("<p>",{class:"text-center",text:" Template deletada com sucesso!",prepend:$("<i>",{class:"glyphicon glyphicon-ok"})})}).appendTo("body"),$("#deletar-sucesso").dialog({modal:!0,buttons:{OK:function(){$(this).dialog("close"),$("#deletar-sucesso").remove()}}})),$(this).dialog("close"),$("#confirma-deletar").remove()},Cancelar:function(){$(this).dialog("close"),$("#confirma-deletar").remove()}}})}}).appendTo("#deletar-template"),$("<button>",{id:"atualizar",class:"btn btn-warning center-block",text:" Atualizar template",prepend:$("<i>",{class:"glyphicon glyphicon-pencil"}),click:function(e){e.preventDefault(),$(location).attr("href","atualizar_template/"+t.numero)}}).appendTo("#atualizar-template"),$.each(o,function(e,t){$("<tr>",{id:"funcionarios-template-"+e}).appendTo("#visualizar-funcionarios"),$("<td>",{text:t.funcionario.matricula}).appendTo("#funcionarios-template-"+e),$("<td>",{text:t.funcionario.nome}).appendTo("#funcionarios-template-"+e),$("<td>",{class:"text-center",append:$("<a>",{text:"Visualizar",style:"cursor: pointer",click:function(e){e.preventDefault(),$("#visualizar-produtos > *").remove(),$.each(t.funcionario.produtos,function(e,t){$("<tr>",{id:"produtos-template-"+e}).appendTo("#visualizar-produtos"),$("<td>",{text:t.codigo}).appendTo("#produtos-template-"+e),$("<td>",{text:t.descricao}).appendTo("#produtos-template-"+e),$("<td>",{text:t.ca}).appendTo("#produtos-template-"+e),$("<td>",{class:"text-center",text:t.unidade}).appendTo("#produtos-template-"+e),$("<td>",{class:"text-center",text:t.quantidade}).appendTo("#produtos-template-"+e)})}})}).appendTo("#funcionarios-template-"+e)}),$("#lista-detalhes-template").modal("toggle")}})}).appendTo("#template-"+e)})}),$("#lista-detalhes-template").on("hidden.bs.modal",function(){$("#visualizar-produtos > *").remove(),$("#visualizar-funcionarios > *").remove(),$("#deletar-template #deletar").remove()}),$("#btn-local-entrega-selecionado-todos").click(function(e){e.preventDefault();var a=[];$.each($.parseJSON(sessionStorage.getItem("template_funcionarios")),function(e,t){a.push({id:t.id,cliente:t.cliente,nome:t.nome,matricula:t.matricula,local:$("#local-entrega-todos option:selected").val(),turno:$("#turno-entrega-todos option:selected").val()})}),$("#selecionar-local-entrega-todos").modal("toggle"),sessionStorage.removeItem("template_funcionarios");var o=new Template,i=o.utilizarTemplate(parseInt(sessionStorage.getItem("numero_template"),10),a,sessionStorage.getItem("template_observacao"),sessionStorage.getItem("template_centro_custo"));if(console.log(i),JSON.parse(i.callback)){var n="SOLICITAÇÃO"===i.tipo?"listar_solicitacoes":"localizar_requisicao";bootbox.alert({size:"small",title:"Sucesso",message:"<div class='alert alert-success'><i class='fa fa-info' aria-hidden='true'></i> Template foi utilizada com sucesso.</div>",callback:function(){t(),$(location).attr("href",n)},closeButton:!1})}else bootbox.alert({size:"small",title:"Erro",message:"<div class='alert alert-danger'><i class='fa fa-info' aria-hidden='true'></i> Ocorreu um problema ao utilizar a template.</div>",callback:function(){t()}})}),$("#btn-local-entrega-template").click(function(e){e.preventDefault();var a=[];$.each($.parseJSON(sessionStorage.getItem("template_funcionarios")),function(e,t){a.push({matricula:t.matricula,nome:t.nome,local:$.trim($("#localFuncionario-"+t.matricula+" option:selected").text()),turno:$.trim($("#turnoFuncionario-"+t.matricula+" option:selected").text())})}),$("#selecionar-local-entrega-template").modal("toggle"),bootbox.alert({size:"small",title:"Sucesso",message:"<div class='alert alert-success'><i class='fa fa-info' aria-hidden='true'></i> Template foi utilizada com sucesso.</div>",callback:function(){t()}})}),$("#selecionar-local-entrega-template").on("hidden.bs.modal",function(){$("#lista-funcionarios-template > *").remove(),sessionStorage.removeItem("template_funcionarios")}),$("#btn-salvar-template").click(function(o){o.preventDefault();var i=new Template,n=$("#txtObservacaoTemplate").val(),s=$.trim($("#txtTemplateDescricao").val());if($.isEmptyObject(JSON.parse(sessionStorage.getItem("template_funcionarios_itens"))))e("Atenção","Você deve acrescentar ao menos 1 produto a uma matricula.",!0);else if($.trim($("#txtTemplateDescricao").val())){var r=i.criar(sessionStorage.getItem("template_funcionarios_itens"),s.toUpperCase(),n.toUpperCase());JSON.parse(r.status)?(e("Sucesso","Template de numero "+r.template+" criada com sucesso!",!1),t(),a()):e("Erro","Ocorreu um erro. Por favor tente mais tarde ou informe para o suporte técnico.")}else e("Atenção","É obrigatório acrescentar um nome para template.",!0)}),$("#btn-buscarProdutoTemplate").click(function(e){e.preventDefault();var t=$.trim($("#txtProduto").val()),a=d.getProdutoFromStorage();funcionarios=new Funcionario,lista=funcionarios.getFuncionarioFromStorage();var o=d.listar(sessionStorage.getItem("cliente"),sessionStorage.getItem("centro_custo"),t,r);s(o,a)}),$("#txtProduto").keyup(function(e){var t=$(this).val().length;(13===e.which||t>=3||0===t)&&(r=1,$("#btn-buscarProdutoTemplate").trigger("click"))}),$("#btn-cancelar").click(function(e){t(),a()}),$("#btn-listarTemplate").trigger("click"),$('input[name="template-atualiza-descricao"]').val()){$("#txtObservacaoTemplate").trigger("keyup");var f=new Template,g=f.detalhes($("#txtTemplateDescricao").data("codigo"));sessionStorage.setItem("cliente",g[0].funcionario.cliente),sessionStorage.setItem("setor",g[0].funcionario.setor),$(window).on("beforeunload",function(e){sessionStorage.removeItem("cliente"),sessionStorage.removeItem("setor")})}});