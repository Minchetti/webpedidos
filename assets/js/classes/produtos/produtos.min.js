(function(){this.Produtos=function(){$.ajaxSetup({dataType:"JSON",type:"POST"}),this.Itens=[],Produtos.prototype.init=function(){sessionStorage.setItem("items",JSON.stringify([])),sessionStorage.setItem("template_funcionarios_itens",JSON.stringify([]))},Produtos.prototype.Luciano=function(e){alert(e)},Produtos.prototype.listar=function(e,t,o,i,a){var r=null;return $.ajax({url:"produto/produto/permitidos",async:!1,data:{cliente:e,setor:t,ghe:o,produto:i,pagina:a},success:function(e){r=e},error:function(e){r=e}}),r},Produtos.prototype.getProdutoFromStorage=function(){return $.parseJSON(sessionStorage.getItem("items"))},Produtos.prototype.getProdutosTemplateFromStorage=function(){return $.parseJSON(sessionStorage.getItem("template_funcionarios_itens"))},Produtos.prototype.adicionar=function(e){var t=[],o=$.parseJSON(sessionStorage.getItem("items"));$.each(e,function(e,i){var a=!0,r=i.item.codigo;$.isEmptyObject(o)||$.each(o,function(e,t){t.item.codigo===r&&(a=!1)}),a&&t.push({item:{codigo:i.item.codigo,descricao:i.item.descricao,ca:i.item.ca,unidade:i.item.unidade,quantidade:i.item.quantidade,partnumber:i.item.partnumber,valor:i.item.valor}})});var i=[];i=$.isEmptyObject(o)?t:o.concat(t),sessionStorage.setItem("items",JSON.stringify(i))},Produtos.prototype.produtosTemplate1=function(e,t){var o=[],i=[];$.isEmptyObject(this.getProdutosTemplateFromStorage())||(i=this.getProdutosTemplateFromStorage(),$.each(i.matricula,function(e,t){var i=t.matricula,a=[];$.each(t.itens,function(e,t){a={codigo:t.codigo,descricao:t.descricao,ca:t.ca,unidade:t.unidade,quantidade:t.quantidade,partnumber:t.partnumber,valor:t.valor}}),o.push({matricula:i,itens:a})})),$.each(t,function(i,a){var r=!0,n=a.codigo,s=[],c=[];if($.isEmptyObject($.parseJSON(sessionStorage.getItem("template_funcionarios_itens")))||(c=$.parseJSON(sessionStorage.getItem("template_funcionarios_itens")),$.each(c.itens,function(t,o){o.codigo===n&&e===c.matricula&&(r=!1)})),r)if($.each(t,function(e,t){s={codigo:t.item.codigo,descricao:t.item.descricao,ca:t.item.ca,unidade:t.item.unidade,quantidade:t.item.quantidade,partnumber:t.item.partnumber,valor:t.item.valor}}),$.isEmptyObject(c))o.push({matricula:e,itens:s});else{var u=[];$.each(c,function(t,i){var a=i.matricula;i.itens.codigo!==s.codigo&&a===e?(console.log(i.itens.codigo," - ",s.codigo," - ",a," - ",e),u.push({codigo:i.itens.codigo,descricao:i.itens.descricao,ca:i.itens.ca,unidade:i.itens.unidade,quantidade:i.itens.quantidade,partnumber:i.itens.partnumber,valor:i.itens.valor})):u.push(i.itens),o.push({matricula:a,itens:u})})}}),sessionStorage.setItem("template_funcionarios_itens",JSON.stringify(o))},Produtos.prototype.concluirItens=function(e){var t=[];void 0!==e&&(varnewvalue=[],t.push({template:{matricula:e,itens:this.Itens}}),$.isEmptyObject(this.getProdutosTemplateFromStorage())?newvalue=t:(colecao=this.getProdutosTemplateFromStorage(),newvalue=colecao.concat(t)),sessionStorage.setItem("template_funcionarios_itens",JSON.stringify(newvalue)),this.Itens=[])},Produtos.prototype.produtosTemplate=function(e){var t=[];$.each(e,function(e,o){t.push({codigo:o.item.codigo,descricao:o.item.descricao,ca:o.item.ca,unidade:o.item.unidade,quantidade:o.item.quantidade,partnumber:o.item.partnumber,valor:o.item.valor})}),this.Itens.push(t)},Produtos.prototype.editar=function(e,t){var o=0,i=this.getProdutoFromStorage();$.each(i,function(a,r){o=a,$.each(r.item,function(a,r){"codigo"===a&&r===e&&(i[o].item.quantidade=t)})}),sessionStorage.removeItem("items"),this.adicionar(i)},Produtos.prototype.remover=function(e){var t=this.getProdutoFromStorage();sessionStorage.removeItem("items"),console.log(t),items=$.grep(t,function(t){return console.log(t.item.codigo!==e),console.log(t.item.codigo,e),t.item.codigo!==e}),this.adicionar(items)},Produtos.prototype.recuperar=function(e){var t=null;return $.ajax({url:"produto/produto/requisicaoitens",async:!1,beforeSend:function(){$("<div>",{id:"loader-itens",title:"Carregando...",append:$("<p>",{class:"text-center",text:"Aguarde enquanto os detalhes são carregados."})}).appendTo("body"),$("#loader-itens").dialog({modal:!0})},data:{requisicao:e},success:function(e){$("#loader-itens").dialog("close"),$("#loader-itens").remove(),t=e},error:function(e){console.log(e)}}),t},Produtos.prototype.solicitacaoItens=function(e){var t=null;return $.ajax({url:"produto/produto/solicitacaoitens",async:!1,beforeSend:function(){$("<div>",{id:"loader-itens",title:"Carregando...",append:$("<p>",{class:"text-center",text:"Aguarde enquanto os detalhes são carregados."})}).appendTo("body"),$("#loader-itens").dialog({modal:!0})},data:{requisicao:e},success:function(e){$("#loader-itens").dialog("close"),$("#loader-itens").remove(),t=e},error:function(e){console.log(e)}}),t}}})();